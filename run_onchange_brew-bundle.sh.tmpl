#!/usr/bin/env bash

# machine_type: {{ .machine.type }}
# brewfile_sha256: {{ include "Brewfile.tmpl" | sha256sum }}

{{- if eq .chezmoi.os "darwin" }}
{{- $brewExists := lookPath "brew" }}
{{- if not $brewExists }}
# Homebrew not found - skip brew bundle
exit 0
{{- else }}

set -euo pipefail

# Generate Brewfile from template in source directory
chezmoi execute-template < "{{ .chezmoi.sourceDir }}/Brewfile.tmpl" > "{{ .chezmoi.sourceDir }}/Brewfile"

# Run brew bundle (quietly, only show changes)
brew bundle --quiet --file="{{ .chezmoi.sourceDir }}/Brewfile"
{{- end }}
{{- end }}

